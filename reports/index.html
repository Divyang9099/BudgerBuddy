<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Geist:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      .net-summary {
        display: flex;
        gap: 2rem;
        margin-bottom: 1.5rem;
      }

      .chart-container {
        margin: 2rem 0;
        padding: 1rem;
        background-color: var(--bg-color);
        border-radius: 8px;
      }

      canvas {
        max-height: 400px;
      }
    </style>
  </head>
  <body>
    <div class="navbar">
      <a class="brand-name" href="#">BUDGETBUDDY</a>
      <div class="nav-links">
        <a href="../">Dashboard</a>
        <a href="../transactions/">Transactions</a>
        <a href="../reports/">Reports</a>
      </div>
      <div class="nav-icons">
        <i class="bi bi-brightness-high" id="theme-toggle"></i>
        <i class="bi bi-gear-fill"></i>
        <i class="bi bi-person-circle"></i>
      </div>
    </div>
    <div class="container">
      <div class="card">
        <div class="dashboard-text">Financial Reports</div>

        <div class="chart-container">
          <canvas id="incomeExpenseChart"></canvas>
        </div>

        <div class="chart-container">
          <canvas id="monthlyTrendChart"></canvas>
        </div>

        <div class="chart-container">
          <canvas id="categoryChart"></canvas>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
    <script src="../script-main.js"></script>
    <script>
      let incomeExpenseChart, monthlyTrendChart, categoryChart;

      function createCharts() {
        // Destroy existing charts if they exist
        if (incomeExpenseChart) incomeExpenseChart.destroy();
        if (monthlyTrendChart) monthlyTrendChart.destroy();
        if (categoryChart) categoryChart.destroy();

        // Income vs Expense Pie Chart
        const income = transactions
          .filter((t) => t.type === "income")
          .reduce((a, t) => a + t.amount, 0);
        const expense = transactions
          .filter((t) => t.type === "expense")
          .reduce((a, t) => a + t.amount, 0);

        incomeExpenseChart = new Chart(
          document.getElementById("incomeExpenseChart"),
          {
            type: "pie",
            data: {
              labels: ["Income", "Expenses"],
              datasets: [
                {
                  data: [income, expense],
                  backgroundColor: ["#4CAF50", "#F44336"],
                },
              ],
            },
          }
        );

        // Monthly Trend Line Chart
        const monthlyData = transactions.reduce((acc, t) => {
          const month = new Date(t.date).toLocaleString("default", {
            month: "short",
          });
          acc[month] = acc[month] || { income: 0, expense: 0 };
          t.type === "income"
            ? (acc[month].income += t.amount)
            : (acc[month].expense += t.amount);
          return acc;
        }, {});

        monthlyTrendChart = new Chart(
          document.getElementById("monthlyTrendChart"),
          {
            type: "line",
            data: {
              labels: Object.keys(monthlyData),
              datasets: [
                {
                  label: "Income",
                  data: Object.values(monthlyData).map((d) => d.income),
                  borderColor: "#4CAF50",
                  fill: false,
                },
                {
                  label: "Expenses",
                  data: Object.values(monthlyData).map((d) => d.expense),
                  borderColor: "#F44336",
                  fill: false,
                },
              ],
            },
          }
        );

        // Category Distribution Bar Chart (Example - add categories to transactions for full functionality)
        const categories = {};
        transactions.forEach((t) => {
          const category = t.category || "Uncategorized";
          categories[category] = (categories[category] || 0) + t.amount;
        });

        categoryChart = new Chart(document.getElementById("categoryChart"), {
          type: "bar",
          data: {
            labels: Object.keys(categories),
            datasets: [
              {
                label: "Amount",
                data: Object.values(categories),
                backgroundColor: "#4a90e2",
              },
            ],
          },
        });
      }

      // Initialize charts when page loads
      document.addEventListener("DOMContentLoaded", createCharts);
    </script>
  </body>
</html>
